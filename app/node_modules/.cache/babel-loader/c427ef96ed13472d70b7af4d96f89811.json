{"ast":null,"code":"import _classCallCheck from\"/Users/rykahsay/projects/glygen-backend-datasetviewer/app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/rykahsay/projects/glygen-backend-datasetviewer/app/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/rykahsay/projects/glygen-backend-datasetviewer/app/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/rykahsay/projects/glygen-backend-datasetviewer/app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from\"react\";import Alertdialog from'./dialogbox';import Loadingicon from\"./loading_icon\";import*as LocalConfig from\"./local_config\";import{Link}from\"react-router-dom\";import DoubleArrowOutlinedIcon from'@material-ui/icons/DoubleArrowOutlined';import{Chart}from\"react-google-charts\";import $ from\"jquery\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var FileUploads=/*#__PURE__*/function(_Component){_inherits(FileUploads,_Component);var _super=_createSuper(FileUploads);function FileUploads(){var _this;_classCallCheck(this,FileUploads);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={confirmation:\"\",viewstatus:0,tabidx:\"failedrows\",cn:\"\",dialog:{status:false,msg:\"\"}};_this.handleDialogClose=function(){var tmpState=_this.state;tmpState.dialog.status=false;tmpState.viewstatus=0;$(\"#tabcn\").css(\"display\",\"none\");_this.setState(tmpState);};_this.handleTitleClick=function(e){var tmpState=_this.state;tmpState.tabidx=e.target.id.split(\"-\")[0];_this.setState(tmpState);};_this.handleGlycanFinder=function(){var reqObj={\"filename\":_this.state.response.inputinfo.name};var requestOptions={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(reqObj)};var svcUrl=LocalConfig.apiHash.dataset_glycan_finder;$(\"#glycan_finder_results_cn\").html(/*#__PURE__*/_jsx(Loadingicon,{}));fetch(svcUrl,requestOptions).then(function(res){return res.json();}).then(function(result){var tmpState=_this.state;tmpState.isLoaded=true;tmpState.response=result;if(result.status===0){tmpState.dialog.status=true;tmpState.dialog.msg=result.error;}_this.setState(tmpState);},function(error){_this.setState({isLoaded:true,error:error});});};_this.handleFileSubmit=function(){var reqObj={\"fname\":\"\",\"lname\":\"\",\"email\":\"\",\"affilation\":\"\"};for(var f in reqObj){reqObj[f]=$('#'+f).val();}reqObj[\"filename\"]=_this.state.response.inputinfo.name;var requestOptions={method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(reqObj)};var svcUrl=LocalConfig.apiHash.dataset_submit;fetch(svcUrl,requestOptions).then(function(res){return res.json();}).then(function(result){var tmpState=_this.state;tmpState.isLoaded=true;if(result.status===0){tmpState.dialog.status=true;tmpState.dialog.msg=result.error;}_this.setState(tmpState);$(\"#submitcn\").html(result.confirmation);},function(error){_this.setState({isLoaded:true,error:error});});};_this.handleFileUpload=function(){var file=$('#userfile')[0].files[0];var fileFormat=$('#formatselector').val();var qcType=$('#qcselector').val();var dataVersion=$('#dataversion').val();var formData=new FormData();formData.append(\"userfile\",file);formData.append(\"format\",fileFormat);formData.append(\"qctype\",qcType);formData.append(\"dataversion\",dataVersion);var tmpState=_this.state;tmpState.viewstatus=1;_this.setState(tmpState);var sizeLimit=1000000000;if(file.size>sizeLimit){var msg='Your submitted file is '+file.size+' Bytes big. ';msg+='This exceeds maximum allowed file size of '+sizeLimit+' Bytes.';var tmpState=_this.state;tmpState.dialog.status=true;tmpState.dialog.msg=msg;_this.setState(tmpState);return;}var requestOptions={method:'POST',body:formData};var svcUrl=LocalConfig.apiHash.dataset_upload;fetch(svcUrl,requestOptions).then(function(res){return res.json();}).then(function(result){var tmpState=_this.state;tmpState.response=result;tmpState.viewstatus=2;tmpState.isLoaded=true;if(tmpState.response.status===0){tmpState.dialog.status=true;tmpState.dialog.msg=tmpState.response.error;}if([\"png\",\"jpeg\"].indexOf(tmpState.response.inputinfo.format)!==-1){tmpState.tabidx=\"glycanfinder\";}_this.setState(tmpState);console.log(\"Ajax response:\",result);},function(error){_this.setState({isLoaded:true,error:error});});};return _this;}_createClass(FileUploads,[{key:\"render\",value:function render(){var formatOptions=[];for(var i in this.props.initObj.fileuploadformats){var obj=this.props.initObj.fileuploadformats[i];formatOptions.push(/*#__PURE__*/_jsx(\"option\",{value:obj.id,children:obj.label}));}var qcOptions=[];for(var i in this.props.initObj.fileuploadqc){var obj=this.props.initObj.fileuploadqc[i];qcOptions.push(/*#__PURE__*/_jsx(\"option\",{value:obj.id,children:obj.label}));}var affOptions=[];for(var i in this.props.initObj.affilations){var obj=this.props.initObj.affilations[i];affOptions.push(/*#__PURE__*/_jsx(\"option\",{value:obj.id,children:obj.label}));}var verOptions=[];for(var i in this.props.initObj.versionlist){var v=this.props.initObj.versionlist[i];verOptions.push(/*#__PURE__*/_jsxs(\"option\",{value:v,children:[\"v-\",v]}));}var tabHash={failedrows:{title:\"Failed Rows\",cn:\"\"},submitfile:{title:\"Submit File\",cn:\"\"},glycanfinder:{title:\"Run Glycan Finder\",cn:\"\"}};if(this.state.dialog.status===false&&this.state.viewstatus===1){$(\"#tabcn\").css(\"display\",\"block\");tabHash.failedrows.cn=/*#__PURE__*/_jsx(Loadingicon,{});tabHash.submitfile.cn=/*#__PURE__*/_jsx(Loadingicon,{});}else if(this.state.dialog.status===false&&this.state.viewstatus===2){if([\"csv\",\"tsv\"].indexOf(this.state.response.inputinfo.format)!==-1){tabHash.failedrows.cn=/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"leftblock\",style:{width:\"100%\",fontWeight:\"bold\"},children:\"Summary\"}),/*#__PURE__*/_jsx(\"div\",{className:\"leftblock\",style:{width:\"100%\",padding:\"10px\",border:\"1px solid #eee\"},children:/*#__PURE__*/_jsx(\"pre\",{children:JSON.stringify(this.state.response.summary,null,4)})}),/*#__PURE__*/_jsx(\"div\",{className:\"leftblock\",style:{margin:\"20px 0px 0px 0px\"},children:/*#__PURE__*/_jsx(Chart,{width:'100%',chartType:\"Table\",loader:/*#__PURE__*/_jsx(\"div\",{children:\"Loading Chart\"}),data:this.state.response.failedrows,options:{showRowNumber:false,width:'100%',height:'100%',allowHtml:true},rootProps:{'data-testid':'1'}})})]});var tmpCn=/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{color:\"red\"},children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),\"This file cannot be uploaded since it has \",this.state.response.summary.fatal_qc_flags,\" fatal error(s).\"]});if(this.state.response.summary.fatal_qc_flags===0){tmpCn=/*#__PURE__*/_jsxs(\"div\",{id:\"submitcn\",className:\"leftblock\",style:{width:\"50%\",margin:\"0px 0px 0px 20px\"},children:[\"Please fill and submit your information. \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),\"First Name\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"fname\",className:\"form-control\"}),/*#__PURE__*/_jsx(\"br\",{}),\"Last Name\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"lname\",className:\"form-control\"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),\"Email Address\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"email\",className:\"form-control\"}),\" \",/*#__PURE__*/_jsx(\"br\",{}),\"Affilation\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"select\",{id:\"affilation\",className:\"form-control\",children:affOptions}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",id:\"submitfile\",value:\"Submit File\",className:\"form-control\",onClick:this.handleFileSubmit})]});}tabHash.submitfile.cn=tmpCn;}else if([\"png\",\"jpeg\"].indexOf(this.state.response.inputinfo.format)!==-1){var server=process.env.REACT_APP_SERVER;var imageUrl=\"/ln2data/userdata/\"+server+\"/tmp/\"+this.state.response.inputinfo.name;var chartCn=\"\";if(\"mappingrows\"in this.state.response){chartCn=/*#__PURE__*/_jsx(Chart,{width:'100%',chartType:\"Table\",loader:/*#__PURE__*/_jsx(\"div\",{children:\"Loading Chart\"}),data:this.state.response.mappingrows,options:{allowHtml:true,showRowNumber:false,width:'100%',height:'100%'},rootProps:{'data-testid':'1'}});}var tmpCn=/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{id:\"submitcn\",className:\"leftblock\",style:{width:\"50%\",margin:\"0px 0px 0px  20px\"},children:[/*#__PURE__*/_jsx(\"img\",{src:imageUrl}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",id:\"run_glycan_finder\",value:\"Run Glycan Finder\",className:\"form-control btn btn-outline-secondary btn-sm\",style:{width:\"200px\"},onClick:this.handleGlycanFinder})]}),/*#__PURE__*/_jsx(\"div\",{id:\"glycan_finder_results_cn\",className:\"leftblock\",style:{width:\"100%\",margin:\"40px 0px 0px  20px\"},children:chartCn})]});tabHash.glycanfinder.cn=tmpCn;}}var tabTitleList=[];var tabContentList=[];for(var tabId in tabHash){var activeFlag=tabId===this.state.tabidx?\"active\":\"\";var btnStyle={width:\"100%\",fontSize:\"15px\",color:\"#333\",border:\"1px solid #ccc\"};btnStyle.color=activeFlag===\"active\"?\"#990000\":\"#333\";btnStyle.background=activeFlag===\"active\"?\"#fff\":\"#eee\";btnStyle.borderBottom=activeFlag===\"active\"?\"1px solid #fff\":\"1px solid #ccc\";tabTitleList.push(/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",role:\"presentation\",style:{width:\"25%\"},children:/*#__PURE__*/_jsx(\"button\",{className:\"nav-link \"+activeFlag,id:tabId+\"-tab\",\"data-bs-toggle\":\"tab\",\"data-bs-target\":\"#sample_view\",type:\"button\",role:\"tab\",\"aria-controls\":\"sample_view-cn\",\"aria-selected\":\"true\",style:btnStyle,onClick:this.handleTitleClick,children:tabHash[tabId].title})},\"tab-\"+tabId));tabContentList.push(/*#__PURE__*/_jsx(\"div\",{className:\"tab-pane fade show  leftblock \"+activeFlag,id:tabId+\"-cn\",role:\"tabpanel\",\"aria-labelledby\":tabId+\"-tab\",style:{width:\"100%\",padding:\"20px\",background:\"#fff\"},children:tabHash[tabId].cn},\"formcn-\"+tabId));}var tabsCn=/*#__PURE__*/_jsxs(\"div\",{id:\"tabcn\",className:\"leftblock\",style:{width:\"100%\",display:\"none\",margin:\"20px 0px 0px 0px\"},children:[/*#__PURE__*/_jsx(\"ul\",{className:\"nav nav-tabs\",id:\"myTab\",role:\"tablist\",style:{width:\"100%\"},children:tabTitleList}),/*#__PURE__*/_jsx(\"div\",{className:\"tab-content\",id:\"myTabContent\",style:{width:\"100%\",margin:\"20px 0px 0px 0px\"},children:tabContentList})]});return/*#__PURE__*/_jsxs(\"div\",{className:\"pagecn\",style:{border:\"0px dashed red\",zIndex:100},children:[/*#__PURE__*/_jsx(Alertdialog,{dialog:this.state.dialog,onClose:this.handleDialogClose}),/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"100%\",margin:\"60px 0px 0px 0px\",fontSize:\"17px\",borderBottom:\"1px solid #ccc\"},children:[/*#__PURE__*/_jsx(DoubleArrowOutlinedIcon,{style:{color:\"#2358C2\",fontSize:\"17px\"}}),\"\\xA0\",/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"reglink\",children:\"HOME \"}),\"\\xA0 / \\xA0\",/*#__PURE__*/_jsx(Link,{to:\"/uploads\",className:\"reglink\",children:\"FILE UPLOADS\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"100%\",margin:\"40px 0px 0px 0px\",border:\"0px dashed orange\"},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"100%\"},children:[\"Upload your csv or tsv file ( example files: \",/*#__PURE__*/_jsx(\"a\",{href:\"/ln2data/downloads/examples/glyco_sites.csv\",className:\"reglink\",download:true,children:\"glyco_sites.csv\"}),\", \\xA0\",/*#__PURE__*/_jsx(\"a\",{href:\"/ln2data/downloads/examples/glyco_sites_unicarbkb.csv\",className:\"reglink\",download:true,children:\"glyco_sites_unicarbkb.csv\"}),\", \",/*#__PURE__*/_jsx(\"a\",{href:\"/ln2data/downloads/examples/glycan_image.png\",className:\"reglink\",download:true,children:\"glycan_image.png\"}),\"). Visit the\",/*#__PURE__*/_jsx(\"a\",{id:\"upload_help\",href:\"/static/upload_help\",className:\"reglink\",children:\" tutorial/help page \"}),\"for detailed information on how to use this functionality.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"25%\",margin:\"20px 0px 0px 0px\",border:\"0px dashed orange\"},children:[/*#__PURE__*/_jsx(\"b\",{children:\"File Format\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"select\",{id:\"formatselector\",className:\"form-control\",children:formatOptions})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"15%\",margin:\"20px 0px 0px 10px\"},children:[/*#__PURE__*/_jsx(\"b\",{children:\"QC Type\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"select\",{id:\"qcselector\",className:\"form-control\",children:qcOptions})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"12%\",margin:\"20px 0px 0px 10px\"},children:[/*#__PURE__*/_jsx(\"b\",{children:\"Data Version\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"select\",{id:\"dataversion\",className:\"form-control\",children:verOptions})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"30%\",margin:\"20px 0px 0px 10px\"},children:[/*#__PURE__*/_jsx(\"b\",{children:\"Select File\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"userfile\",className:\"form-control\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"leftblock\",style:{width:\"10%\",margin:\"20px 0px 0px 10px\"},children:[\" \\xA0\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",name:\"userfile\",value:\"Upload File\",className:\"form-control\",onClick:this.handleFileUpload})]}),/*#__PURE__*/_jsx(\"div\",{className:\"leftblock\",style:{width:\"100%\",margin:\"15px 0px 0px 0px\",borderBottom:\"1px solid #ccc\"}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"leftblock\",style:{width:\"100%\",margin:\"40px 0px 0px 0px\",border:\"0px dashed orange\"},children:tabsCn})]});}}]);return FileUploads;}(Component);export default FileUploads;","map":{"version":3,"sources":["/Users/rykahsay/projects/glygen-backend-datasetviewer/app/src/components/file_uploads.jsx"],"names":["React","Component","Alertdialog","Loadingicon","LocalConfig","Link","DoubleArrowOutlinedIcon","Chart","$","FileUploads","state","confirmation","viewstatus","tabidx","cn","dialog","status","msg","handleDialogClose","tmpState","css","setState","handleTitleClick","e","target","id","split","handleGlycanFinder","reqObj","response","inputinfo","name","requestOptions","method","headers","body","JSON","stringify","svcUrl","apiHash","dataset_glycan_finder","html","fetch","then","res","json","result","isLoaded","error","handleFileSubmit","f","val","dataset_submit","handleFileUpload","file","files","fileFormat","qcType","dataVersion","formData","FormData","append","sizeLimit","size","dataset_upload","indexOf","format","console","log","formatOptions","i","props","initObj","fileuploadformats","obj","push","label","qcOptions","fileuploadqc","affOptions","affilations","verOptions","versionlist","v","tabHash","failedrows","title","submitfile","glycanfinder","width","fontWeight","padding","border","summary","margin","showRowNumber","height","allowHtml","tmpCn","color","fatal_qc_flags","server","process","env","REACT_APP_SERVER","imageUrl","chartCn","mappingrows","tabTitleList","tabContentList","tabId","activeFlag","btnStyle","fontSize","background","borderBottom","tabsCn","display","zIndex"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport Alertdialog from './dialogbox';\nimport Loadingicon from \"./loading_icon\";\nimport * as LocalConfig from \"./local_config\";\nimport { Link } from \"react-router-dom\";\nimport DoubleArrowOutlinedIcon from '@material-ui/icons/DoubleArrowOutlined';\nimport { Chart } from \"react-google-charts\";\n\nimport $ from \"jquery\";\n\n\nclass FileUploads extends Component {\n  \n  state = {\n    confirmation:\"\",\n    viewstatus:0,\n    tabidx:\"failedrows\",\n    cn:\"\",\n    dialog:{\n      status:false, \n      msg:\"\"\n    }\n  };\n\n\n  handleDialogClose = () => {\n    var tmpState = this.state;\n    tmpState.dialog.status = false;\n    tmpState.viewstatus = 0;\n    $(\"#tabcn\").css(\"display\", \"none\");\n    this.setState(tmpState);\n  }\n\n  handleTitleClick = (e) => {\n    var tmpState = this.state;\n    tmpState.tabidx = e.target.id.split(\"-\")[0];\n    this.setState(tmpState);\n  };\n\n\n  handleGlycanFinder = () => {\n\n    var reqObj = {\"filename\":this.state.response.inputinfo.name};\n    const requestOptions = {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(reqObj)\n    };\n    const svcUrl = LocalConfig.apiHash.dataset_glycan_finder;\n    \n    $(\"#glycan_finder_results_cn\").html(<Loadingicon/>);\n\n    fetch(svcUrl, requestOptions)\n      .then((res) => res.json())\n      .then(\n        (result) => {\n          var tmpState = this.state;\n          tmpState.isLoaded = true;\n          tmpState.response = result;\n          if (result.status === 0){\n            tmpState.dialog.status = true;\n            tmpState.dialog.msg = result.error;\n          }\n          this.setState(tmpState);\n        },\n        (error) => {\n          this.setState({\n            isLoaded: true,\n            error,\n          });\n        }\n      );\n\n  }\n\n\n\n\n  handleFileSubmit = () => {\n\n    var reqObj = {\"fname\":\"\", \"lname\":\"\", \"email\":\"\", \"affilation\":\"\"};\n    for (var f in reqObj){\n      reqObj[f] = $('#'+f).val();\n    }\n    reqObj[\"filename\"] = this.state.response.inputinfo.name;\n \n    const requestOptions = {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(reqObj)\n    };\n    const svcUrl = LocalConfig.apiHash.dataset_submit;\n\n    fetch(svcUrl, requestOptions)\n      .then((res) => res.json())\n      .then(\n        (result) => {\n          var tmpState = this.state;\n          tmpState.isLoaded = true;\n          if (result.status === 0){\n            tmpState.dialog.status = true;\n            tmpState.dialog.msg = result.error;\n          }\n          this.setState(tmpState);\n          $(\"#submitcn\").html(result.confirmation);\n        },\n        (error) => {\n          this.setState({\n            isLoaded: true,\n            error,\n          });\n        }\n      );\n\n  }\n\n\n\n  handleFileUpload = () => {\n    \n    var file = $('#userfile')[0].files[0];\n    var fileFormat = $('#formatselector').val();\n    var qcType = $('#qcselector').val();\n    var dataVersion = $('#dataversion').val();\n\n    var formData = new FormData();\n    formData.append(\"userfile\", file);\n    formData.append(\"format\", fileFormat);\n    formData.append(\"qctype\", qcType);\n    formData.append(\"dataversion\", dataVersion);\n    \n    var tmpState = this.state;\n    tmpState.viewstatus = 1;\n    this.setState(tmpState);\n\n\n    var sizeLimit = 1000000000;\n    if (file.size > sizeLimit){\n        var msg = 'Your submitted file is ' + file.size + ' Bytes big. ';\n        msg += 'This exceeds maximum allowed file size of ' + sizeLimit + ' Bytes.';\n        var tmpState = this.state;\n        tmpState.dialog.status = true;\n        tmpState.dialog.msg = msg;\n        this.setState(tmpState);\n        return;\n    }\n   \n    const requestOptions = { \n      method: 'POST', \n      body: formData\n    };\n    const svcUrl = LocalConfig.apiHash.dataset_upload;\n\n    fetch(svcUrl, requestOptions)\n      .then((res) => res.json())\n      .then(\n        (result) => {\n          var tmpState = this.state;\n          tmpState.response = result;\n          tmpState.viewstatus = 2;\n          tmpState.isLoaded = true;\n          if (tmpState.response.status === 0){\n            tmpState.dialog.status = true;\n            tmpState.dialog.msg = tmpState.response.error;\n          }\n          if ([\"png\", \"jpeg\"].indexOf(tmpState.response.inputinfo.format) !== -1){\n            tmpState.tabidx = \"glycanfinder\";\n          }\n          this.setState(tmpState);\n          console.log(\"Ajax response:\", result);\n        },\n        (error) => {\n          this.setState({\n            isLoaded: true,\n            error,\n          });\n        }\n      );\n\n  }\n\n\n\n\n  render() {\n\n\n\n    var formatOptions = [];\n    for (var i in this.props.initObj.fileuploadformats){\n      var obj = this.props.initObj.fileuploadformats[i];\n      formatOptions.push(<option value={obj.id}>{obj.label}</option>);\n    }\n\n    var qcOptions = [];\n    for (var i in this.props.initObj.fileuploadqc){\n      var obj = this.props.initObj.fileuploadqc[i];\n      qcOptions.push(<option value={obj.id}>{obj.label}</option>);\n    }\n    var affOptions = [];\n    for (var i in this.props.initObj.affilations){\n      var obj = this.props.initObj.affilations[i];\n      affOptions.push(<option value={obj.id}>{obj.label}</option>);\n    }\n    \n    var verOptions = [];\n    for (var i in this.props.initObj.versionlist){\n      var v = this.props.initObj.versionlist[i];\n      verOptions.push(<option value={v}>v-{v}</option>);\n    }\n\n\n\n    var tabHash = {\n        failedrows:{ title:\"Failed Rows\", cn:\"\"},\n        submitfile: { title:\"Submit File\", cn:\"\"},\n        glycanfinder:{title:\"Run Glycan Finder\", cn:\"\"}\n    };\n    if (this.state.dialog.status === false && this.state.viewstatus === 1){\n      $(\"#tabcn\").css(\"display\", \"block\");\n      tabHash.failedrows.cn = (<Loadingicon/>)\n      tabHash.submitfile.cn = (<Loadingicon/>)\n    } \n    else if (this.state.dialog.status === false && this.state.viewstatus === 2){\n        if ([\"csv\", \"tsv\"].indexOf(this.state.response.inputinfo.format) !== -1){\n            tabHash.failedrows.cn = (\n              <div className=\"leftblock\">\n                <div className=\"leftblock\" style={{width:\"100%\", fontWeight:\"bold\"}}>\n                  Summary\n                </div>\n                <div className=\"leftblock\" style={{width:\"100%\", padding:\"10px\", border:\"1px solid #eee\"}}>\n                  <pre>{JSON.stringify(this.state.response.summary, null, 4)}</pre>\n                </div>\n                <div className=\"leftblock\" style={{margin:\"20px 0px 0px 0px\"}}>\n                  <Chart width={'100%'} chartType=\"Table\" loader={<div>Loading Chart</div>}\n                    data={this.state.response.failedrows}\n                    options={{showRowNumber: false, width: '100%', height: '100%', \n                        allowHtml: true }}\n                    rootProps={{ 'data-testid': '1' }}   \n                  />\n                </div>\n              </div>\n            );\n            var tmpCn = (\n              <div className=\"leftblock\" style={{color:\"red\"}}> \n                <br/><br/>\n                This file cannot be uploaded since it has {this.state.response.summary.fatal_qc_flags} fatal error(s).\n              </div>\n            );\n            if (this.state.response.summary.fatal_qc_flags === 0){\n              tmpCn = (\n                <div id=\"submitcn\" className=\"leftblock\" style={{width:\"50%\", margin:\"0px 0px 0px 20px\"}}>\n                    Please fill and submit your information. <br/><br/>\n                    First Name<br/>\n                    <input type=\"text\" id=\"fname\" className=\"form-control\" /><br/>\n                    Last Name<br/>\n                    <input type=\"text\" id=\"lname\" className=\"form-control\" /> <br/>\n                    Email Address<br/>\n                    <input type=\"text\" id=\"email\" className=\"form-control\" /> <br/>\n                    Affilation<br/>\n                    <select id=\"affilation\"  className=\"form-control\">\n                      {affOptions}\n                    </select><br/>\n                    <input type=\"submit\" id=\"submitfile\"  value=\"Submit File\" className=\"form-control\"\n                      onClick={this.handleFileSubmit}\n                    />\n \n                </div>\n              );\n            }\n            tabHash.submitfile.cn = tmpCn;\n        }\n        else if ([\"png\", \"jpeg\"].indexOf(this.state.response.inputinfo.format) !== -1){\n          var server = process.env.REACT_APP_SERVER;\n          var imageUrl = \"/ln2data/userdata/\"+server+\"/tmp/\" + this.state.response.inputinfo.name;\n          \n          var chartCn = \"\";\n          if (\"mappingrows\" in this.state.response){\n              chartCn = (\n                <Chart width={'100%'} chartType=\"Table\" loader={<div>Loading Chart</div>}\n                  data={this.state.response.mappingrows}\n                  options={{allowHtml: true, showRowNumber: false, width: '100%', height: '100%'}}\n                  rootProps={{ 'data-testid': '1' }}\n                />\n              );\n          }\n          var tmpCn = (\n                <div>\n                <div id=\"submitcn\" className=\"leftblock\" style={{width:\"50%\", margin:\"0px 0px 0px  20px\"}}>\n                  <img src={imageUrl}/><br/>\n                  <input type=\"submit\" id=\"run_glycan_finder\"  value=\"Run Glycan Finder\" \n                      className=\"form-control btn btn-outline-secondary btn-sm\" \n                      style={{width:\"200px\"}}\n                      onClick={this.handleGlycanFinder}\n                    />\n                </div>\n                <div id=\"glycan_finder_results_cn\" className=\"leftblock\" \n                  style={{width:\"100%\", margin:\"40px 0px 0px  20px\"}}>{chartCn}</div>\n                </div>\n            );\n            tabHash.glycanfinder.cn = tmpCn;\n        }\n    }\n\n    var tabTitleList= [];\n    var tabContentList = []; \n    for (var tabId in tabHash){\n        var activeFlag = (tabId === this.state.tabidx ? \"active\" : \"\" );\n        var btnStyle = {width:\"100%\", fontSize:\"15px\", color:\"#333\", border:\"1px solid #ccc\"};\n        btnStyle.color = (activeFlag === \"active\" ? \"#990000\" : \"#333\");\n        btnStyle.background = (activeFlag === \"active\" ? \"#fff\" : \"#eee\");\n        btnStyle.borderBottom = (activeFlag === \"active\" ? \"1px solid #fff\" : \"1px solid #ccc\");\n        tabTitleList.push(\n                <li key={\"tab-\"+tabId} className=\"nav-item\" role=\"presentation\"\n                  style={{width:\"25%\"}}>\n                  <button className={\"nav-link \" + activeFlag}\n                  id={tabId + \"-tab\"}  data-bs-toggle=\"tab\"\n                  data-bs-target={\"#sample_view\"} type=\"button\" role=\"tab\" aria-controls={\"sample_view-cn\"} aria-selected=\"true\"\n                  style={btnStyle} onClick={this.handleTitleClick}\n                >\n                  {tabHash[tabId].title}\n                </button>\n              </li>\n        );\n        tabContentList.push(\n                <div key={\"formcn-\"+tabId}\n                  className={\"tab-pane fade show  leftblock \" + activeFlag}\n                  id={tabId+\"-cn\"} role=\"tabpanel\" aria-labelledby={tabId + \"-tab\"}\n                  style={{width:\"100%\",  padding:\"20px\", background:\"#fff\"}}>\n                  {tabHash[tabId].cn}\n                </div>);\n    }\n\n\n    var tabsCn = (\n            <div id=\"tabcn\" className=\"leftblock\" style={{width:\"100%\", display:\"none\", margin:\"20px 0px 0px 0px\"}}>\n              <ul className=\"nav nav-tabs\" id=\"myTab\" role=\"tablist\" style={{width:\"100%\"}}>\n                {tabTitleList}\n              </ul>\n              <div className=\"tab-content\" id=\"myTabContent\"\n                  style={{width:\"100%\", margin:\"20px 0px 0px 0px\"}}>\n                {tabContentList}\n              </div>\n          </div>);\n\n\n    return (\n      <div className=\"pagecn\" style={{border:\"0px dashed red\", zIndex:100}}>\n        <Alertdialog dialog={this.state.dialog} onClose={this.handleDialogClose}/>\n        <div className=\"leftblock\" style={{width:\"100%\", \n          margin:\"60px 0px 0px 0px\", \n          fontSize:\"17px\", borderBottom:\"1px solid #ccc\"}}>\n          <DoubleArrowOutlinedIcon style={{color:\"#2358C2\", fontSize:\"17px\" }}/>\n          &nbsp;\n          <Link to=\"/\" className=\"reglink\">HOME </Link> \n            &nbsp; / &nbsp;\n          <Link to={\"/uploads\"} className=\"reglink\">FILE UPLOADS</Link> \n        </div>\n        <div className=\"leftblock\" style={{width:\"100%\", margin:\"40px 0px 0px 0px\", border:\"0px dashed orange\"}}>\n            <div className=\"leftblock\" style={{width:\"100%\"}}> \n              Upload your csv or tsv file (\n                example files: <a href=\"/ln2data/downloads/examples/glyco_sites.csv\" className=\"reglink\" download>glyco_sites.csv</a>, &nbsp; \n                <a href=\"/ln2data/downloads/examples/glyco_sites_unicarbkb.csv\" className=\"reglink\" download>glyco_sites_unicarbkb.csv</a>, <a href=\"/ln2data/downloads/examples/glycan_image.png\" className=\"reglink\" download>glycan_image.png</a>). \n                Visit the \n                  <a id=\"upload_help\" href=\"/static/upload_help\" className=\"reglink\"> tutorial/help page </a>\n                 for detailed information on how to use this functionality.\n              \n            </div>\n            <div className=\"leftblock\" style={{width:\"25%\", margin:\"20px 0px 0px 0px\",border:\"0px dashed orange\"}}>\n              <b>File Format</b><br/>\n              <select id=\"formatselector\"  className=\"form-control\">\n                {formatOptions}\n              </select>\n            </div>\n\n            <div className=\"leftblock\" style={{width:\"15%\", margin:\"20px 0px 0px 10px\"}}>\n              <b>QC Type</b><br/>\n              <select id=\"qcselector\"  className=\"form-control\">\n                {qcOptions}\n              </select>\n            </div>\n            \n            <div className=\"leftblock\" style={{width:\"12%\", margin:\"20px 0px 0px 10px\"}}>\n              <b>Data Version</b><br/>\n              <select id=\"dataversion\"  className=\"form-control\">\n                {verOptions}\n              </select>\n            </div>\n          \n            <div className=\"leftblock\" style={{width:\"30%\", margin:\"20px 0px 0px 10px\"}}>\n              <b>Select File</b><br/>\n              <input type=\"file\" id=\"userfile\"  className=\"form-control\"/>\n            </div>\n\n            <div className=\"leftblock\" style={{width:\"10%\", margin:\"20px 0px 0px 10px\"}}> &nbsp;<br/>\n              <input \n                type=\"submit\" name=\"userfile\"  value=\"Upload File\" className=\"form-control\"\n                onClick={this.handleFileUpload}\n              />\n            </div>\n        <div className=\"leftblock\" style={{width:\"100%\",margin:\"15px 0px 0px 0px\",borderBottom:\"1px solid #ccc\"}}></div>\n      </div>\n\n       <div className=\"leftblock\" style={{width:\"100%\", margin:\"40px 0px 0px 0px\", border:\"0px dashed orange\"}}>\n          {tabsCn}\n        </div>\n\n      </div>\n    );\n  }\n}\n\nexport default FileUploads;\n\n"]},"metadata":{},"sourceType":"module"}